---
title: "Elasticsearch 核心概念"
date: 2022-05-12
categories:
- tranquilpeak
- features
tags:
- Elasticsearch
# keywords:
# - Elasticsearch
thumbnailImagePosition: left
# thumbnailImage: //d1u9biwaxjngwg.cloudfront.net/elements-showcase/vintage-140.jpg
---

<!--more-->

### Elasticsearch 核心概念

#### elasticsearch 主要核心点就是集群 节点 索引 类型 文档 分片 映射

```
elasticsearch（集群）中可以包含多个索引（数据库） ,每个索引中可以包含多个类型（表） ,每个类型下又包含多个文档（行） ,每个文档中又包含多个字段（列)
```

```
elasticsearch 是面向文档 ，一切都是json ！ 
物理设计 ： elasticsearch 在后台把每个索引划分成多个切片，每个分片可以在集群中的不同服务器间迁移。
逻辑设计 ： 一个索引类型中，包含多个文档，比如说 文档1，文档2 ，当我们索引一片文档时，可以通过这样的顺序找到它：索引 => 类型 => 文档ID ，通过这个组合我们就能索引到某个具体的文档。 注意：ID不必是整数，实际上它是个字符串。
之前说elasticsearch是面向文档的，那么就意味着索引和搜索数据的最小单位是文档，elasticsearch中，文档有几个重要属性:
自我包含，一篇文档同时包含字段和对应的值，也就是同时包含key:value !
可以是层次型的，一个文档中包含自文档，复杂的逻辑实体就是这么来的! {就是一个json对象 ! }
灵活的结构，文档不依赖预先定义的模式，我们知道关系型数据库中，要提前定义字段才能使用，在elasticsearch中，对于字段是非常灵活的，有时候,我们可以忽略该字段，或者动态的添加一个新的字段
```

#### 集群

```
    ES节点：运行的ES实例
    ES集群由若干节点组成，这些节点在同一个网络内，cluster-name相同节点:
    master节点：集群中的一个节点会被选为master节点，它将负责管理集群范畴的变更，例如创建或删除索引，添加节点到集群或从集群删除节点。master节点无需参与文档层面的变更和搜索，这意味着仅有一个master节点并不会因流量增长而成为瓶颈。任意一个节点都可以成为 master 节点
    data节点：持有数据和倒排索引。默认情况下，每个节点都可以通过设定配置文件elasticsearch.yml中的node.data属性为true(默认)成为数据节点。如果需要一个专门的主节点，应将其node.data属性设置为false
    Client节点：如果将node.master属性和node.data属性都设置为false，那么该节点就是一个客户端节点，扮演一个负载均衡的角色，将到来的请求路由到集群中的各个节点

```

#### 分片

```
    （1）单个节点由于物理机硬件限制，存储的文档是有限的，如果一个索引包含海量文档，则不能在单个节点存储。ES提供分片机制，同一个索引可以存储在不同分片（数据容器）中，这些分片又可以存储在集群中不同节点上
    （2）分片分为 主分片(primary shard) 以及 从分片(replica shard) 
    （3）主分片与从分片关系：从分片只是主分片的一个副本，它用于提供数据的冗余副本 
    （4）从分片应用：在硬件故障时提供数据保护，同时服务于搜索和检索这种只读请求 
    （5）是否可变：索引中的主分片的数量在索引创建后就固定下来了，但是从分片的数量可以随时改变 
    （6）索引默认创建的分片：默认设置5个主分片和一组从分片（即每个主分片有一个从分片对应），但是从分片没有被启用主从分片在同一个节点上没有意义），因此集群健康值显示为黄色(yellow)

```

#### 节点

```
一个集群至少有一个节点，而一个节点就是一个elasricsearch进程，节点可以有多个索引默认的，如果你创建索引，那么索引将会有个5个分片(primary shard ,又称主分片)构成的，每一个主分片会有一个副本(replica shard，又称复制分片)
```

![](/img/elinfos1.png)

```
上图是一个有3个节点的集群，可以看到主分片和对应的复制分片都不会在同一个节点内，这样有利于某个节点挂掉了，数据也不至于失。实际上，一个分片是一个Lucene索引（<mark>一个ElasticSearch索引包含多个Lucene索引</mark>） ，一个包含倒排索引的文件目录，倒排索引的结构使得elasticsearch在不扫描全部文档的情况下，就能告诉你哪些文档包含特定的关键字
```



#### 索引-index

类型-type:7.x 弱化。8.x 完全删除了 _doc

```
简单说就是 按（文章关键字，对应的文档\<0个或多个\>）形式建立索引，根据关键字就可直接查询对应的文档（含关键字的），无需查询每一个文档，如下图
```

![](/img/elinfos2.png)

```
在elasticsearch 中 ，索引（库）这个词被频繁使用 ，这就是术语的使用。在elasticsearch 中索引被分为多个分片，每个分分片是luncene的索引。所以说一个elasticsearch 索引是由多个luncene 索引组成的
```

